---
title: "そもそもラスタとは何やねん"
---
# はじめに

# ラスタデータ=ビットマップ+地理参照情報+NoData値

## ビットマップ

ラスタデータは、地面を規則正しい格子に区切り、格子ごとにデータを入れたものです。データは数値スカラまたは数値ベクトルに限られ、ベクトルの次元は全ての格子で同じでなければなりません。

規則正しい格子をピクセルに見立てるとビットマップになりそうにかんじたあなたはするどい。ラスタデータは、データ表現上はビットマップデータと同じです。JPEGはRGB各1バイトからなるデータと言えます。PNGはRGBAの4種からなるデータ、MAGはRGBI各1ビットのデータです。なのでラスタデータになりえます。

しかしながら、一般のビットマップデータには地理参照情報が入っていないので、地図上のどの領域に表示していいか全く分かりません。

そこで、ビットマップに地理参照情報を付与する必要があります。地理参照情報を付与する際に、外部ファイルを使う場合と内部に埋め込む場合とがあります。

## 地理参照情報

### 変換パラメータ

地理参照情報として必要なものは、ビットマップの隅のひとつ（原則として左上隅）の位置と、ピクセル１つあたりの地図上でのサイズです。ここまで出たら、各ピクセルが地図上のどこを指すかは簡単な掛け算と足し算からなる計算で算出できますね。

これだと拡大縮小とシフトだけですが、もう少し拡張して、アフィン変換と考えると、回転も含めた地理参照が可能になります。

```
| a11 a12 a13 |
| a21 a22 a23 |
|   0   0   1 |
```

という行列を適用すると、ピクセルの位置``(px, py)``と地図上の位置``(ux, uy)``との関係は、次のようになります。

```
ux = a11*px + a12*py + a13
uy = a21*px + a22*py + a23
```

地理参照情報を追加するには、外部ファイルを使う方式と、内部に埋め込む方式があります。前者にはワールドファイル (ファイル名の拡張子を少し変えたファイルに地理参照情報を書き込んでいます)があり、後者にはGeoTIFF (TIFFのタグで地理参照情報を埋めんでいます)。

### 空間参照系

前述のアフィン変換でピクセル座標系からアフィン変換による座標変換ができましたが、アフィン変換によって得られる座標系では、単位は何になるでしょう、原点はどこでしょう、といった情報はありません。

単位や原点といったパラメータは、指定した空間参照系に従います。GeoTIFFでは、空間参照系も埋め込めます。ワールドファイルでは空間参照系の指定はできません。

## NoData値

一般的なビットマップは人に見せるものであることが多いかと思います。「ラスタデータ」の場合は、計算に使うデータセットとしての側面もあるので、欠測は欠測として保存できなければなりません。PNG+ワールドファイルでは対応できませんが、ラスタデータとしてしっかりしているフォーマットでは、NoData値（ベクトル）が設定できるようになっています。NoData値は、そのデータセットでは取りえない値をデータ作成者が選択します。

たとえば、国土地理院発行の標高データでは、-9999.0 をNoData値としています。標高 -9999.0\[m\] は、海水面から1万メートルといったら、いくつかの海溝で出てくるぐらいで、陸域を扱う場合にはありえない値です。

NoData値が納められているピクセルの扱いはデータ利用者が決めます。たとえば、集計計算から除外したり、周りのピクセルの値にあわせたり、固定値を持たせたり、さまざまあることでしょう。ラスタデータを表示する場合には、そのピクセルを表示しないようにするのが一般的です。いずれにしても、NoData値の値をそのまま使うことは、ほとんどありません。

## 「バンド」という言葉

ラスタデータでは、頻繁に「バンド」という言葉が出てきます。「バンド」とは、個々のピクセルが持つベクトルの成分です。
一般的なビットマップでは R, G, Bの3次元ベクトルを持っていますが、R, G, B個々の色、つまりチャネルが、ラスタデータのバンドに相当します。

ここで言うバンドは、本来は電磁波（光も含みます）の「波長帯」を指します。R, G, Bのいずれも、その値は、特定の波長帯の電磁波の強さを意味しています。なので、R, G, Bは、いずれも個々のバンドです。

しかし、バンドはR, G, Bのように「色」を意味するだけではありません。リモートセンシング(衛星や飛行機から地表のデータをセンサーで取得する)においては、R, G, Bだけを取るわけでなく、たとえばIR(近赤外線)データも取っている場合があります。その場合はIRのバンド値を持つのですが、IRを「色」だと言われたら、疑問に感じます。

以上から、「バンド」はR, G, Bの「色」を含みますが、バンドは色だけに限定されないことが分かります。

## バンドのデータ型

続いて、バンドのデータ型について見てみましょう。

PNGでは符号なし4バンドともに1バイト整数ですが、ラスタデータの場合は、バンド数がまちまちですし、前述の通り、必ずしもR, G, Bのバンドとは限りません。たとえばIR(近赤外線), R, G, Bを取ったデータもあります。また、植生指数を計算するだけなら、IRとRだけを使用するため、2バンドで充分です。

また、バンドごとの数値型もさまざまです。PNGは0-255を取る符号なし1バイト整数ですが、倍精度浮動小数点数を使う場合もありますし、符号付き4バイト整数もありえます。

このため、ラスタデータのフォーマットでは、バンド数、数値型が固定されておらず、需要に柔軟に対応できますが、複雑なフォーマットになります。

# おわりに

ラスタデータはビットマップと同じですが、地理空間と結びつけるよう参照データを添える点、バンド数と数値型が任意に定められる点が異なることを紹介しました。

まだピンと来ないかもしれませんが、そういうものだと、ぼんやり覚えておいて下さい。
