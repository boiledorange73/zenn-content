---
title: "ジオメトリタイプ一覧の残ったものを眺める"
---
# はじめに

[ジオメトリタイプ一覧を眺める](https://zenn.dev/boiledorange73/books/caea8d4c77dbba2e23a0/viewer/geomtypes) ([PostGIS入門](https://zenn.dev/boiledorange73/books/caea8d4c77dbba2e23a0)) では、主要なジオメトリタイプを紹介しました。

ここでは、残ったジオメトリタイプについて見ていきます。

# タイプ一覧

タイプは、次の通りです。

|タイプ|意味|
|------|----|
|POINT|単一の点|
|LINESTRING|単一の折れ線|
|POLYGON|単一のポリゴン、リングは複数あっても良い|
|**POLYHEDRALSURFACE**|**多面体サーフェス（立体）**|
|**TRIANGLE**|**三角形**|
|MULTIPOINT|複数の点からなるジオメトリ|
|MULTILINESTRING|複数の折れ線からなるジオメトリ|
|MULTIPOLYGON|複数のポリゴンからなるジオメトリ|
|**TIN**|**複数の三角形からなるジオメトリ**|
|**GEOMETRYCOLLECTION**|**上記ジオメトリの集合、要素のタイプは他の要素のタイプと異なっても良い**|

# 座標次元は4次元まで

座標次元は、指定しない場合には2次元とされます。座標次元の拡張は可能で、WKTでは、タイプ名の次に ``z``、``m``とか`zm``を付けます。

## Z と M の違い

座標次元が同じ3次元でも、XYZとXYMでは考え方が違います。

# 多面体サーフェス

多面体の面となるジオメトリです。ポリゴンの集合で、各ポリゴンは境界線を共有します（隙間を作らない）。また、立体を構成する面では、表と裏とを区別する必要があるため、右ねじの法則に従わなければなりません。

ただし、PostGIS (少なくとも 2.1) では、境界線を共有しない多面体サーフェスを（マルチポリゴンでしかないけれども）許容しますし、右ねじの法則に従わない面があっても隙間が無ければボリュームと認識します。

ポリゴン(2次元不規則位置配列)の集合なので、3次元不規則位置配列になります。

次に三角錐の例を示します。

```
polyhedralsurface z(
  ((0 0 0, 1 0 0, 1 0 1, 0 0 0)),
  ((1 0 0, 1 1 0, 1 0 1, 1 0 0)),
  ((1 1 0, 0 0 0, 1 0 1, 1 1 0)),
  ((0 0 0, 1 1 0, 1 0 0, 0 0 0))
)
```

三角錐から底を除いた多面体サーフェスは許容されますが、ボリュームではないと認識されます。

```
db=# SELECT ST_IsClosed(
'POLYHEDRALSURFACE Z(
  ((0 0 0, 1 0 0, 1 0 1, 0 0 0)),
  ((1 0 0, 1 1 0, 1 0 1, 1 0 0)),
  ((1 1 0, 0 0 0, 1 0 1, 1 1 0))
)'::GEOMETRY);
 st_isclosed 
-------------
 f
(1 行)
```

# 三角形

## TRIANGLE

ポリゴンの特殊形で、三角形に限定されます。リングの数は1個で、かつノードの数は4個でなければなりません。ノードが3個でなく4個なのは、ポリゴンのリングは閉じなければならないからです。

```
triangle((x1 y1, x2 y2, x3 y3, x1 y1))
```

## TIN

OGCシンプルフィーチャーの定義によると「三角形パッチのみからなる多面体サーフェス」です。そのため、TRIANGLEのマルチ系ジオメトリととらえられます。よって、マルチポリゴンと同じ3次元位置配列となりますが、パッチごとに4点でなければなりません。

```
tin(((x11 y11, x12 y12, x13 y13, x11 y11)),((...)),...)
tin z(((x11 y11 z11, x12 y12 z12, x13 y13 z13, x11 y11 z11)),((...)),...)
```

# GEOMETRYCOLLECTION

GEOMETRYCOLLECTIONは、様々なタイプのジオメトリをまとめて一つのジオメトリとするためのものです。ただし、座標次元は全ての要素で同じである必要があります。たとえば、次のように、``point``も``linestring``も``polygon``も、みんな一つにまとめられます。

```
geometrycollection(point(0 0), polygon((30 30, 40 30, 40 40, 30 40, 30 30)), linestring(1 2, 11 22))
```

しかし、なんでも受け付けるがために、逆に面倒になります。

通常の場合、カラムごとにジオメトリタイプを指定していて、そのカラムが別のジオメトリタイプを取ることは想定していません。

仮に複数のジオメトリタイプのジオメトリを導入したいなら、別カラムに作ればいいのです。たとえば、市区町村ポリゴンと、代表点（ラベルの中心に使う）とをセットで置いておきたいなら、``poygon``タイプのカラムと``point``タイプのカラムとを作ります。ここでジオメトリコレクションを使うべきではありません。

ジオメトリタイプは混ざって欲しくないのです。でも混ぜることができてしまうので、好きになれません。

# おわりに

OGCのシンプルフィーチャーのうち、PostGIS入門で説明したもの以外について、WKT表現で見てみました。WKTで表現できるものとしてはこれで全てとなります。

ここで紹介したもののち、多面体サーフェスや TIN は、座標次元が2次元のデータを扱う場合には、あまり使わないかも知れません。ただ、ジオメトリコレクションは、ジオメトリの加工をしていると何度か目にすることになると思います。
